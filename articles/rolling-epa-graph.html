<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rolling EPA Graph â€¢ cfbfastR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Rolling EPA Graph">
<meta property="og:description" content="&lt;strong&gt;IT'S GRAPHIN' TIME&lt;/strong&gt;&lt;br&gt; ^&lt;em&gt;To be said in an extremely Power Rangers voice&lt;em&gt;^">
<meta property="og:image" content="https://github.com/saiemgilani/cfbfastR-data/blob/master/themes/social_card_cfbfastR_final_quote.png?raw=true">
<meta property="og:image:alt" content="When you code good, you know good. When you know good, you win good. When you win good, they pay good.">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:creator" content="@cfbnate">
<meta name="twitter:site" content="@cfbfastR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-SE5ZJL93W6"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-SE5ZJL93W6');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cfbfastR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.8.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fas fa-code"></span>
     
    Funcs
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../reference/index.html">Function Index</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">cfbfastR Data</li>
    <li>
      <a href="../reference/load_cfb_pbp.html">Load Full Season PBP Data</a>
    </li>
    <li>
      <a href="../reference/update_cfb_db.html">Update or Create Database</a>
    </li>
    <li>
      <a href="../reference/cfbd_pbp_data.html">Play-by-Play Data</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">CFB Data</li>
    <li>
      <a href="../reference/register_cfbd.html">CFBD API Keys</a>
    </li>
    <li>
      <a href="../reference/cfbd_games.html">Games</a>
    </li>
    <li>
      <a href="../reference/cfbd_play.html">Plays</a>
    </li>
    <li>
      <a href="../reference/cfbd_drives.html">Drives</a>
    </li>
    <li>
      <a href="../reference/cfbd_teams.html">Teams</a>
    </li>
    <li>
      <a href="../reference/cfbd_players.html">Players</a>
    </li>
    <li>
      <a href="../reference/cfbd_stats.html">Statistics</a>
    </li>
    <li>
      <a href="../reference/cfbd_metrics.html">Metrics</a>
    </li>
    <li>
      <a href="../reference/cfbd_ratings.html">Ratings</a>
    </li>
    <li>
      <a href="../reference/cfbd_draft.html">Draft</a>
    </li>
    <li>
      <a href="../reference/cfbd_betting.html">Betting</a>
    </li>
    <li>
      <a href="../reference/cfbd_recruiting.html">Recruiting</a>
    </li>
    <li>
      <a href="../reference/cfbd_coaches.html">Coaches</a>
    </li>
    <li>
      <a href="../reference/cfbd_conferences.html">Conferences</a>
    </li>
    <li>
      <a href="../reference/cfbd_venues.html">Venues</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">ESPN Data</li>
    <li>
      <a href="../reference/espn_metrics.html">ESPN Metrics</a>
    </li>
    <li>
      <a href="../reference/espn_ratings.html">ESPN Ratings</a>
    </li>
    <li>
      <a href="../reference/espn_cfb_scoreboard.html">ESPN Scoreboard</a>
    </li>
    <li>
      <a href="../reference/espn_cfb_pbp.html">ESPN PBP</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fas fa-book-reader"></span>
     
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/index.html">Vignettes</a>
    </li>
    <li class="dropdown-header">Introductory</li>
    <li>
      <a href="../articles/intro.html">CFB Analytics with cfbfastR</a>
    </li>
    <li>
      <a href="../articles/animated-wp-plotting.html">Animated Win Probability Plots</a>
    </li>
    <li>
      <a href="../articles/fourth-down-plot-tutorial.html">Fourth Down Tendency Plots</a>
    </li>
    <li>
      <a href="../articles/rolling-epa-graph.html">Rolling EPA Graphs</a>
    </li>
    <li>
      <a href="../articles/nth-rated-recruit.html">Visualizing Team Talent with Player Recruit Rankings</a>
    </li>
    <li>
      <a href="../articles/map-tutorial.html">Intro to Visualizing Recruiting Geography</a>
    </li>
    <li class="dropdown-header">Expected Points Model Fundamentals</li>
    <li>
      <a href="../articles/college-football-expected-points-model-fundamentals-part-i.html">Part 1 - Model Definition</a>
    </li>
    <li>
      <a href="../articles/college-football-expected-points-model-fundamentals-part-ii.html">Part 2 - Regression Models</a>
    </li>
    <li>
      <a href="../articles/college-football-expected-points-model-fundamentals-part-iii.html">Part 3 - History of Expected Points Models</a>
    </li>
    <li class="dropdown-header">CFBD Tutorials</li>
    <li>
      <a href="../articles/cfbd_betting.html">CFBD Betting</a>
    </li>
    <li>
      <a href="../articles/cfbd_games.html">CFBD Games</a>
    </li>
    <li>
      <a href="../articles/cfbd_plays.html">CFBD Plays</a>
    </li>
    <li>
      <a href="../articles/cfbd_recruiting.html">CFBD Recruiting</a>
    </li>
    <li>
      <a href="../articles/cfbd_stats.html">CFBD Stats</a>
    </li>
    <li>
      <a href="../articles/cfbd_teams.html">CFBD Teams</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">
    <span class="fas fa-newspaper"></span>
     
     News
  </a>
</li>
<li>
  <a href="http://gameonpaper.com/cfb" class="external-link">
    <span class="fas fa-football-ball"></span>
     
     GP
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fas fa-project-diagram"></span>
     
     SDV
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://sportsdataverse.org/" class="external-link">SportsDataverse</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">R Packages</li>
    <li>
      <a href="https://r.sportsdataverse.org/" class="external-link">sportsdataverse-R</a>
    </li>
    <li>
      <a href="https://cfbfastR.sportsdataverse.org/">cfbfastR</a>
    </li>
    <li>
      <a href="https://hoopR.sportsdataverse.org/" class="external-link">hoopR</a>
    </li>
    <li>
      <a href="https://wehoop.sportsdataverse.org/" class="external-link">wehoop</a>
    </li>
    <li>
      <a href="https://fastRhockey.sportsdataverse.org/" class="external-link">fastRhockey</a>
    </li>
    <li>
      <a href="https://jaseziv.github.io/worldfootballR/" class="external-link">worldfootballR</a>
    </li>
    <li>
      <a href="https://BillPetti.github.io/baseballr/" class="external-link">baseballr</a>
    </li>
    <li>
      <a href="https://kazink36.github.io/cfbplotR/" class="external-link">cfbplotR</a>
    </li>
    <li>
      <a href="https://kazink36.github.io/cfb4th/" class="external-link">cfb4th</a>
    </li>
    <li>
      <a href="https://recruitR.sportsdataverse.org/" class="external-link">recruitR</a>
    </li>
    <li>
      <a href="https://jacklich10.github.io/gamezoneR/" class="external-link">gamezoneR</a>
    </li>
    <li>
      <a href="https://puntalytics.github.io/puntr/" class="external-link">puntr</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Python Packages</li>
    <li>
      <a href="https://py.sportsdataverse.org/" class="external-link">sportsdataverse-py</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Node.js Packages</li>
    <li>
      <a href="https://js.sportsdataverse.org/" class="external-link">sportsdataverse.js</a>
    </li>
    <li>
      <a href="https://github.com/nntrn/nfl-nerd/" class="external-link">nfl-nerd</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fas fa-database"></span>
     
     Data
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://collegefootballdata.com" class="external-link">CFBData.com</a>
    </li>
    <li>
      <a href="https://github.com/saiemgilani/cfbfastR-data" class="external-link">Data Repository</a>
    </li>
    <li>
      <a href="https://github.com/saiemgilani/cfbfastR-raw" class="external-link">Raw Data Repository</a>
    </li>
  </ul>
</li>
<li>
  <a></a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="http://twitter.com/cfbfastR" class="external-link">
    <span class="fab fa-twitter fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/saiemgilani/cfbfastR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="rolling-epa-graph_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Rolling EPA Graph</h1>
                        <h4 data-toc-skip class="author">Nate Manzo <br><a href="https://twitter.com/cfbnate" target="blank" class="external-link"><img src="https://img.shields.io/twitter/follow/cfbnate?color=blue&amp;label=%40cfbnate&amp;logo=twitter&amp;style=for-the-badge" alt="@cfbnate"></a> <a href="https://github.com/natemanzo" target="blank" class="external-link"><img src="https://img.shields.io/github/followers/natemanzo?color=eee&amp;logo=Github&amp;style=for-the-badge" alt="@natemanzo"></a>
</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/saiemgilani/cfbfastR/blob/HEAD/vignettes/rolling-epa-graph.rmd" class="external-link"><code>vignettes/rolling-epa-graph.rmd</code></a></small>
      <div class="hidden name"><code>rolling-epa-graph.rmd</code></div>

    </div>

    
    
<p>This vignette will use data from the <code>cfbfastR</code> package to create a moving average graph of offensive EPA over the course of a season. This lets us visualize how a teamâ€™s performance has changed over time and compare that performance to other teams around the country.</p>
<div class="section level2">
<h2 id="load-and-install-the-necessary-packages">Load and Install the necessary packages<a class="anchor" aria-label="anchor" href="#load-and-install-the-necessary-packages"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">'pacman'</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'pacman'</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html" class="external-link">p_load</a></span><span class="op">(</span><span class="va">tidyverse</span>, <span class="va">zoo</span>, <span class="va">ggimage</span>, <span class="va">cfbfastR</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="pull-the-play-by-play-data">Pull the play by play data<a class="anchor" aria-label="anchor" href="#pull-the-play-by-play-data"></a>
</h2>
<p>Using the <a href="https://saiemgilani.github.io/cfbfastR/reference/load_cfb_pbp.html" class="external-link">load_cfb_pbp()</a> method, we will pull down a dataframe that contains ALL of the play by play data for ALL teams in 2021. This method only takes about 30 seconds.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">yr</span> <span class="op">&lt;-</span> <span class="fu">cfbfastR</span><span class="fu">:::</span><span class="fu">most_recent_season</span><span class="op">(</span><span class="op">)</span>
<span class="va">pbp</span> <span class="op">&lt;-</span> <span class="fu">cfbfastR</span><span class="fu">::</span><span class="fu"><a href="../reference/load_cfb_pbp.html">load_cfb_pbp</a></span><span class="op">(</span><span class="va">yr</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="pull-team-info-and-team-colors">Pull team info and team colors<a class="anchor" aria-label="anchor" href="#pull-team-info-and-team-colors"></a>
</h2>
<p>We can use the <code><a href="../reference/cfbd_team_info.html">cfbd_team_info()</a></code> function to pull information about each FBS school including their logo, color, and abbreviation. Weâ€™re going to take a subset of the cfb_team_info data and clean it up for use in our graphs later on.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">team_info</span> <span class="op">=</span> <span class="fu">cfbfastR</span><span class="fu">::</span><span class="fu"><a href="../reference/cfbd_team_info.html">cfbd_team_info</a></span><span class="op">(</span>year <span class="op">=</span> <span class="va">yr</span><span class="op">)</span>

<span class="va">team_colors_logos</span> <span class="op">=</span> <span class="va">team_info</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">school</span>, <span class="va">abbreviation</span>, <span class="va">color</span>, <span class="va">logo</span>, <span class="va">alt_color</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">school</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">slice</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="basic-overview-of-all-fbs-offenses">Basic overview of all FBS Offenses<a class="anchor" aria-label="anchor" href="#basic-overview-of-all-fbs-offenses"></a>
</h2>
<p>Letâ€™s create a basic overview of offensive EPA per play. Weâ€™ll start by creating a dataframe listing all 130 FBS teams from best to worst based on their average EPA per play across all games played.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">off_epa</span> <span class="op">=</span> <span class="va">pbp</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">rush</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">pass</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">offense_play</span>, <span class="va">offense_conference</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarize</span><span class="op">(</span>off_epa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">EPA</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">off_epa</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">rename</span><span class="op">(</span>Team <span class="op">=</span> <span class="va">offense_play</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">offense_conference</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>Rank <span class="op">=</span> <span class="fu">row_number</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>TeamRank <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">Team</span>, <span class="st">" #"</span>, <span class="va">Rank</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>We can use the <code><a href="https://rdrr.io/r/utils/head.html" class="external-link">head()</a></code> function to take a quick peak at what our new dataframe looks like. The teams at the top should not be surprising. Remember, EPA is not adjusted for the strength of opponent. It is purely a measure of how teams perform on the field (like yards, but better).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">off_epa</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 6 Ã— 5</span></span>
<span class="co">##   Team             offense_conference off_epa  Rank TeamRank           </span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              </span>
<span class="co">## <span style="color: #BCBCBC;">1</span> Coastal Carolina Sun Belt             0.286     1 Coastal Carolina #1</span>
<span class="co">## <span style="color: #BCBCBC;">2</span> Ohio State       Big Ten              0.275     2 Ohio State #2      </span>
<span class="co">## <span style="color: #BCBCBC;">3</span> Oklahoma         Big 12               0.193     3 Oklahoma #3        </span>
<span class="co">## <span style="color: #BCBCBC;">4</span> BYU              FBS Independents     0.187     4 BYU #4             </span>
<span class="co">## <span style="color: #BCBCBC;">5</span> Western Kentucky Conference USA       0.178     5 Western Kentucky #5</span>
<span class="co">## <span style="color: #BCBCBC;">6</span> SMU              American Athletic    0.178     6 SMU #6</span></code></pre>
<p>Ok, now letâ€™s start to visualize the data beyond the top few schools. Letâ€™s graph all the teams that have a positive EPA on the year.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">off_epa</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">off_epa</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html" class="external-link">reorder</a></span><span class="op">(</span><span class="va">TeamRank</span>, <span class="va">off_epa</span><span class="op">)</span>, y<span class="op">=</span><span class="va">off_epa</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Average EPA Per Play"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Offensive EPA Per Play | Positive EPA Teams"</span>,
       caption <span class="op">=</span> <span class="st">"Chart by @cfbNate
       Data from @CFB_Data via @cfbfastr"</span><span class="op">)</span> </code></pre></div>
<p><img src="rolling-epa-graph_files/figure-html/graph_top_offenses-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="prepare-the-data-for-the-moving-average-chart">Prepare the data for the moving average chart<a class="anchor" aria-label="anchor" href="#prepare-the-data-for-the-moving-average-chart"></a>
</h2>
<p>So far, so good, but we came here to build a moving average chart! Letâ€™s proceed by defining the team of interest and the moving average window by editing the cell block below. I like to use 100 plays when looking at a full season to smooth out as much of the variability as possible, but for a mid-season view 50 plays or even 25 plays might be more appropriate. Play around!</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">team</span> <span class="op">=</span> <span class="st">"Oklahoma"</span>
<span class="va">ma_plays</span> <span class="op">=</span> <span class="fl">100</span></code></pre></div>
<p>Now that we have defined our team of interest, we can prepare the data for this specific team. Weâ€™re going to create a dataframe called <code>team_off</code> that is subsetted from our full season play by play data. This new dataframe will be specific to our team of interest and it will add fields for the moving average and the play count.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">team_off</span> <span class="op">=</span> <span class="va">pbp</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">offense_play</span> <span class="op">==</span> <span class="va">team</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">rush</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">pass</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">EPA</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>cu_epa<span class="op">=</span><span class="fu">cummean</span><span class="op">(</span><span class="va">EPA</span><span class="op">)</span>,  <span class="co">#this field is not used in this vignette but it could be substituted later to graph the cumulative EPA</span>
         ma_epa<span class="op">=</span><span class="fu">rollapply</span><span class="op">(</span><span class="va">EPA</span>,<span class="va">ma_plays</span>,<span class="va">mean</span>,align<span class="op">=</span><span class="st">'right'</span>,fill<span class="op">=</span><span class="cn">NA</span><span class="op">)</span>,
         play_count <span class="op">=</span> <span class="fu">row_number</span><span class="op">(</span><span class="op">)</span>,
         week_team <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"WK"</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">week</span> <span class="op">&gt;</span> <span class="fl">9</span>, <span class="va">week</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">week</span><span class="op">)</span><span class="op">)</span>, <span class="st">" "</span>, <span class="va">defense_play</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Weâ€™re going to graph different background tiles for each opponent so we need to define where one opponent stops and another one begins.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">team_off_play_start</span> <span class="op">=</span> <span class="va">team_off</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">week_team</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">slice</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">defense_play</span>, <span class="va">week_team</span>, <span class="va">play_count</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">rename</span><span class="op">(</span>play_start <span class="op">=</span> <span class="va">play_count</span>,
         team <span class="op">=</span> <span class="va">defense_play</span><span class="op">)</span>

<span class="va">team_off_play_stop</span> <span class="op">=</span> <span class="va">team_off</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">week_team</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">row_number</span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">week_team</span>, <span class="va">play_count</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">rename</span><span class="op">(</span>play_stop <span class="op">=</span> <span class="va">play_count</span><span class="op">)</span></code></pre></div>
<p>Weâ€™re going to add the opponentâ€™s logo in the middle of each background tile, so we need to define the midpoint of each background tile as well.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">team_off_start_stop</span> <span class="op">=</span> <span class="va">team_off_play_start</span> <span class="op">%&gt;%</span>
  <span class="fu">left_join</span><span class="op">(</span><span class="va">team_off_play_stop</span>, by <span class="op">=</span> <span class="st">"week_team"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>midpoint <span class="op">=</span> <span class="op">(</span><span class="va">play_start</span> <span class="op">+</span> <span class="va">play_stop</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<p>We need to make a simple vector that says how many total plays are in our <code>team_off</code> dataframe.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">play_count</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">team_off</span><span class="op">$</span><span class="va">play_count</span><span class="op">)</span></code></pre></div>
<p>Next we are going to update our background tile dataframe to include the color info that we pulled earlier. FCS color data is not available, so we will default those to gray.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">team_off_start_stop</span> <span class="op">=</span> <span class="va">team_off_start_stop</span> <span class="op">%&gt;%</span> 
  <span class="fu">left_join</span><span class="op">(</span><span class="va">team_colors_logos</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"team"</span> <span class="op">=</span> <span class="st">"school"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>color <span class="op">=</span> <span class="fu">replace_na</span><span class="op">(</span><span class="va">color</span>,<span class="st">"gray"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">team</span>, <span class="va">week_team</span>, <span class="va">play_start</span>, <span class="va">play_stop</span>, <span class="va">midpoint</span>, <span class="va">color</span><span class="op">)</span></code></pre></div>
<p>Are we ready to graph yet? Just a few more steps! We need a named vector to get the right colors on those background tiles.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">team_colors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">team_off_start_stop</span><span class="op">$</span><span class="va">color</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">team_colors</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">team_off_start_stop</span><span class="op">$</span><span class="va">team</span><span class="op">)</span></code></pre></div>
<p>Now we need to pull in an alternate source of team logos that includes FCS schools. Then weâ€™ll join that new table of logos with our background tile dataframe.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">all_logos</span> <span class="op">=</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/natemanzo/cfb_data/master/_team_logos.csv"</span><span class="op">)</span>

<span class="va">team_off_start_stop</span> <span class="op">=</span> <span class="va">team_off_start_stop</span> <span class="op">%&gt;%</span> 
  <span class="fu">left_join</span><span class="op">(</span><span class="va">all_logos</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"team"</span> <span class="op">=</span> <span class="st">"school"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Almost done! The last thing we need is your signature to go in the caption of the graph. You can use your twitter handle or your real name here.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">signature</span> <span class="op">=</span> <span class="st">"@cfbNate"</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="its-graphin-time">ITâ€™S GRAPHINâ€™ TIME*<a class="anchor" aria-label="anchor" href="#its-graphin-time"></a>
</h2>
<p><sup>*ToÂ beÂ saidÂ inÂ anÂ extremelyÂ PowerÂ RangersÂ voice</sup></p>
<p>The beginning of the line graph will depend on the <code>ma_plays</code> variable that you defined earlier. Dashed lines indicating the EPA/play of the 25th percentile, median, 75th percentile, and top and bottom teams in the country are drawn on the graph to show context for how the team of interest compares to the rest of the country.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">graph_team_off</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_rect</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">team_off_start_stop</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">play_start</span>, xmax <span class="op">=</span> <span class="va">play_stop</span>, fill <span class="op">=</span> <span class="va">team</span>, ymin <span class="op">=</span> <span class="op">-</span><span class="fl">.5</span>, ymax <span class="op">=</span> <span class="fl">.9</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"gray90"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_rect</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">team_off_start_stop</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">play_start</span>, xmax <span class="op">=</span> <span class="va">play_stop</span>, ymin <span class="op">=</span> <span class="fl">.8</span>, ymax <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"gray90"</span>, fill <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">team_colors</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">off_epa</span><span class="op">$</span><span class="va">off_epa</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"gray20"</span>, alpha <span class="op">=</span> <span class="fl">.8</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, linetype <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">"gray20"</span>, alpha <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_image</span><span class="op">(</span>data<span class="op">=</span><span class="va">team_off_start_stop</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">midpoint</span>,y<span class="op">=</span><span class="fl">.9</span>,image<span class="op">=</span><span class="va">logo</span><span class="op">)</span>, asp <span class="op">=</span> <span class="fl">16</span><span class="op">/</span><span class="fl">9</span>, size <span class="op">=</span> <span class="fl">.05</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">-</span><span class="fl">2</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">off_epa</span><span class="op">$</span><span class="va">off_epa</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, geom <span class="op">=</span> <span class="st">"text"</span>, size <span class="op">=</span> <span class="fl">3</span>, hjust <span class="op">=</span> <span class="st">"right"</span>, vjust <span class="op">=</span> <span class="fl">0</span>, label <span class="op">=</span> <span class="va">off_epa</span> <span class="op">%&gt;%</span> <span class="fu">slice</span><span class="op">(</span><span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">pull</span><span class="op">(</span><span class="va">Team</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">-</span><span class="fl">2</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">off_epa</span><span class="op">$</span><span class="va">off_epa</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, geom <span class="op">=</span> <span class="st">"text"</span>, size <span class="op">=</span> <span class="fl">3</span>, hjust <span class="op">=</span> <span class="st">"right"</span>, vjust <span class="op">=</span> <span class="fl">0</span>, label <span class="op">=</span> <span class="st">"25%ile"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">-</span><span class="fl">2</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">off_epa</span><span class="op">$</span><span class="va">off_epa</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, geom <span class="op">=</span> <span class="st">"text"</span>, size <span class="op">=</span> <span class="fl">3</span>, hjust <span class="op">=</span> <span class="st">"right"</span>, vjust <span class="op">=</span> <span class="fl">0</span>, label <span class="op">=</span> <span class="st">"Median"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">-</span><span class="fl">2</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">off_epa</span><span class="op">$</span><span class="va">off_epa</span><span class="op">)</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, geom <span class="op">=</span> <span class="st">"text"</span>, size <span class="op">=</span> <span class="fl">3</span>, hjust <span class="op">=</span> <span class="st">"right"</span>, vjust <span class="op">=</span> <span class="fl">0</span>, label <span class="op">=</span> <span class="st">"75%ile"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">-</span><span class="fl">2</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">off_epa</span><span class="op">$</span><span class="va">off_epa</span><span class="op">)</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>, geom <span class="op">=</span> <span class="st">"text"</span>, size <span class="op">=</span> <span class="fl">3</span>, hjust <span class="op">=</span> <span class="st">"right"</span>, vjust <span class="op">=</span> <span class="fl">0</span>, label <span class="op">=</span> <span class="va">off_epa</span> <span class="op">%&gt;%</span> <span class="fu">slice</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">pull</span><span class="op">(</span><span class="va">Team</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">team_off</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">play_count</span>, y <span class="op">=</span> <span class="va">ma_epa</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"white"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">team_off</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">play_count</span>, y <span class="op">=</span> <span class="va">ma_epa</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1.25</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"EPA"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Number of Plays"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">team</span>,<span class="st">" Offensive EPA | "</span>,<span class="va">ma_plays</span>,<span class="st">"-Play Moving Average"</span><span class="op">)</span>,
       caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Chart by "</span>,<span class="va">signature</span>,<span class="st">" using code from @cfbNate
       Data from @CFB_Data via @cfbfastR"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">20</span>, <span class="va">play_count</span><span class="op">)</span>,  <span class="co"># This leaves room for the labels over the dashed lines</span>
                  clip <span class="op">=</span> <span class="st">'off'</span><span class="op">)</span>               <span class="co"># This keeps the labels from disappearing</span>

<span class="va">graph_team_off</span></code></pre></div>
<p><img src="rolling-epa-graph_files/figure-html/graph_the_graph-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Lastly, you can save your graph to your working directory by running the line below. PC users will notice the saved graphic will have a higher resolution and less pixelization than the graphic generated above.</p>
<p>Reminder: You can always use <code><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd()</a></code> to find out what your current working directory is if youâ€™re not sure.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="va">graph_team_off</span>, filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"off_epa_rolling_"</span>,<span class="va">team</span>,<span class="st">".png"</span><span class="op">)</span>, 
       dpi <span class="op">=</span> <span class="fl">300</span>, type <span class="op">=</span> <span class="st">"cairo"</span>, width <span class="op">=</span> <span class="fl">10</span>, height <span class="op">=</span> <span class="fl">7</span>, units <span class="op">=</span> <span class="st">"in"</span><span class="op">)</span></code></pre></div>
<p>I hope you found this useful! As always, thanks to <a href="https://twitter.com/CFB_Data" class="external-link">@CFB_Data</a> and the <a href="https://twitter.com/cfbfastR" class="external-link">@cfbfastR</a> team for making this possible. And shout out to folks like Parker Fleming (<a href="https://twitter.com/statsowar" class="external-link">@statsowar</a>) and Meyappan Subbaiah (<a href="https://twitter.com/msubbiah1" class="external-link">@msubbiah1</a>) for their feedback, advice, and encouragement while refining the look of this visualization. Tag me in any of these graphs you post on twitter and Iâ€™ll share them as much as possible.</p>
<p>-<a href="https://twitter.com/cfbNate" class="external-link">Nate Manzo</a></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://twitter.com/saiemgilani" class="external-link">Saiem Gilani</a>, <a href="https://twitter.com/akeaswaran" class="external-link">Akshay Easwaran</a>, <a href="https://twitter.com/JaredDLee" class="external-link">Jared Lee</a>, <a href="https://twitter.com/arbitanalytics" class="external-link">Eric Hess</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '002e977de61519c48dce057f58ed1d24',
    indexName: 'cfbfastR',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
