<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="cfbfastR">
<title>Intro to Visualizing Recruiting Geography • cfbfastR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Intro to Visualizing Recruiting Geography">
<meta property="og:description" content="cfbfastR">
<meta property="og:image" content="https://github.com/sportsdataverse/cfbfastR-data/blob/main/themes/social_card_cfbfastR_final_quote.png?raw=true">
<meta property="og:image:alt" content="When you code good, you know good. When you know good, you win good. When you win good, they pay good.">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:creator" content="@ConorMcQ5">
<meta name="twitter:site" content="@cfbfastR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">cfbfastR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.9.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--funcs">
    <span class="fas fa fas fa-code"></span>
     
    Funcs
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--funcs">
    <a class="dropdown-item" href="../reference/index.html">Function Index</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>cfbfastR Data</h6>
    <a class="dropdown-item" href="../reference/load_cfb_pbp.html">Load Full Season PBP Data</a>
    <a class="dropdown-item" href="../reference/update_cfb_db.html">Update or Create Database</a>
    <a class="dropdown-item" href="../reference/cfbd_pbp_data.html">Play-by-Play Data</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>CFB Data</h6>
    <a class="dropdown-item" href="../reference/register_cfbd.html">CFBD API Keys</a>
    <a class="dropdown-item" href="../reference/cfbd_games.html">Games</a>
    <a class="dropdown-item" href="../reference/cfbd_play.html">Plays</a>
    <a class="dropdown-item" href="../reference/cfbd_drives.html">Drives</a>
    <a class="dropdown-item" href="../reference/cfbd_teams.html">Teams</a>
    <a class="dropdown-item" href="../reference/cfbd_players.html">Players</a>
    <a class="dropdown-item" href="../reference/cfbd_stats.html">Statistics</a>
    <a class="dropdown-item" href="../reference/cfbd_metrics.html">Metrics</a>
    <a class="dropdown-item" href="../reference/cfbd_ratings.html">Ratings</a>
    <a class="dropdown-item" href="../reference/cfbd_draft.html">Draft</a>
    <a class="dropdown-item" href="../reference/cfbd_betting_lines.html">Betting</a>
    <a class="dropdown-item" href="../reference/cfbd_recruiting.html">Recruiting</a>
    <a class="dropdown-item" href="../reference/cfbd_coaches.html">Coaches</a>
    <a class="dropdown-item" href="../reference/cfbd_conferences.html">Conferences</a>
    <a class="dropdown-item" href="../reference/cfbd_venues.html">Venues</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>ESPN Data</h6>
    <a class="dropdown-item" href="../reference/espn_metrics.html">ESPN Metrics</a>
    <a class="dropdown-item" href="../reference/espn_ratings_fpi.html">ESPN Ratings</a>
    <a class="dropdown-item" href="../reference/espn_cfb_scoreboard.html">ESPN Scoreboard</a>
    <a class="dropdown-item" href="../reference/espn_cfb_pbp.html">ESPN PBP</a>
  </div>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--articles">
    <span class="fas fa fas fa-book-reader"></span>
     
    Articles
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--articles">
    <a class="dropdown-item" href="../articles/index.html">Vignettes</a>
    <h6 class="dropdown-header" data-toc-skip>Introductory</h6>
    <a class="dropdown-item" href="../articles/intro.html">CFB Analytics with cfbfastR</a>
    <a class="dropdown-item" href="../articles/animated-wp-plotting.html">Animated Win Probability Plots</a>
    <a class="dropdown-item" href="../articles/fourth-down-plot-tutorial.html">Fourth Down Tendency Plots</a>
    <a class="dropdown-item" href="../articles/rolling-epa-graph.html">Rolling EPA Graphs</a>
    <a class="dropdown-item" href="../articles/nth-rated-recruit.html">Visualizing Team Talent with Player Recruit Rankings</a>
    <a class="dropdown-item" href="../articles/map-tutorial.html">Intro to Visualizing Recruiting Geography</a>
    <h6 class="dropdown-header" data-toc-skip>Expected Points Model Fundamentals</h6>
    <a class="dropdown-item" href="../articles/college-football-expected-points-model-fundamentals-part-i.html">Part 1 - Model Definition</a>
    <a class="dropdown-item" href="../articles/college-football-expected-points-model-fundamentals-part-ii.html">Part 2 - Regression Models</a>
    <a class="dropdown-item" href="../articles/college-football-expected-points-model-fundamentals-part-iii.html">Part 3 - History of Expected Points Models</a>
    <h6 class="dropdown-header" data-toc-skip>CFBD Tutorials</h6>
    <a class="dropdown-item" href="../articles/cfbd_betting.html">CFBD Betting</a>
    <a class="dropdown-item" href="../articles/cfbd_games.html">CFBD Games</a>
    <a class="dropdown-item" href="../articles/cfbd_plays.html">CFBD Plays</a>
    <a class="dropdown-item" href="../articles/cfbd_recruiting.html">CFBD Recruiting</a>
    <a class="dropdown-item" href="../articles/cfbd_stats.html">CFBD Stats</a>
    <a class="dropdown-item" href="../articles/cfbd_teams.html">CFBD Teams</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">
    <span class="fas fa fas fa-newspaper"></span>
     
     News
  </a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--sdv">
    <span class="fas fa fas fa-project-diagram"></span>
     
     SDV
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--sdv">
    <a class="external-link dropdown-item" href="https://sportsdataverse.org/">SportsDataverse</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>R Packages</h6>
    <a class="external-link dropdown-item" href="https://r.sportsdataverse.org/">sportsdataverse-R</a>
    <a class="dropdown-item" href="https://cfbfastR.sportsdataverse.org/">cfbfastR</a>
    <a class="external-link dropdown-item" href="https://hoopR.sportsdataverse.org/">hoopR</a>
    <a class="external-link dropdown-item" href="https://wehoop.sportsdataverse.org/">wehoop</a>
    <a class="external-link dropdown-item" href="https://torvik.dev/">toRvik</a>
    <a class="external-link dropdown-item" href="https://fastRhockey.sportsdataverse.org/">fastRhockey</a>
    <a class="external-link dropdown-item" href="https://BillPetti.github.io/baseballr/">baseballr</a>
    <a class="external-link dropdown-item" href="https://jaseziv.github.io/worldfootballR/">worldfootballR</a>
    <a class="external-link dropdown-item" href="https://jaseziv.github.io/chessR/">chessR</a>
    <a class="external-link dropdown-item" href="https://sportyR.sportsdataverse.org/">sportyR</a>
    <a class="external-link dropdown-item" href="https://kazink36.github.io/cfbplotR/">cfbplotR</a>
    <a class="external-link dropdown-item" href="https://kazink36.github.io/cfb4th/">cfb4th</a>
    <a class="external-link dropdown-item" href="https://github.com/camdenk/mlbplotR">mlbplotR</a>
    <a class="external-link dropdown-item" href="https://recruitr.sportsdataverse.org/">recruitR</a>
    <a class="external-link dropdown-item" href="https://jacklich10.github.io/gamezoneR/">gamezoneR</a>
    <a class="external-link dropdown-item" href="https://puntalytics.github.io/puntr/">puntr</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Python Packages</h6>
    <a class="external-link dropdown-item" href="https://py.sportsdataverse.org/">sportsdataverse-py</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Node.js Packages</h6>
    <a class="external-link dropdown-item" href="https://js.sportsdataverse.org/">sportsdataverse.js</a>
    <a class="external-link dropdown-item" href="https://github.com/nntrn/nfl-nerd/">nfl-nerd</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--data">
    <span class="fas fa fas fa-database"></span>
     
     Data
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--data">
    <a class="external-link dropdown-item" href="https://collegefootballdata.com">CFBData.com</a>
    <a class="external-link dropdown-item" href="https://github.com/sportsdataverse/cfbfastR-data">Data Repository</a>
    <a class="external-link dropdown-item" href="https://github.com/sportsdataverse/cfbfastR-raw">Raw Data Repository</a>
  </div>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="http://gameonpaper.com/cfb">
    <span class="fas fa fas fa-football-ball"></span>
     
     GP
  </a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="http://twitter.com/cfbfastR">
    <span class="fab fa fab fa-twitter fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/sportsdataverse/cfbfastR/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="map-tutorial_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Intro to Visualizing Recruiting Geography</h1>
                        <h4 data-toc-skip class="author">Conor R. McQuiston <br><a href="https://twitter.com/ConorMcQ5" target="blank" class="external-link"><img src="https://img.shields.io/twitter/follow/ConorMcQ5?color=blue&amp;label=%40ConorMcQ5&amp;logo=twitter&amp;style=for-the-badge" alt="@ConorMcQ5"></a> <a href="https://github.com/mcqconor" target="blank" class="external-link"><img src="https://img.shields.io/github/followers/mcqconor?color=eee&amp;logo=Github&amp;style=for-the-badge" alt="@mcqconor"></a>
</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/sportsdataverse/cfbfastR/blob/HEAD/vignettes/map-tutorial.Rmd" class="external-link"><code>vignettes/map-tutorial.Rmd</code></a></small>
      <div class="d-none name"><code>map-tutorial.Rmd</code></div>
    </div>

    
    
<p>The best high school football talent in America is not even across the country. Some states produce bunches of talent, such as Texas, Florida, and California, while other states are hardpressed to produce more than a handful every couple years, such as Montana, Maine, and the Dakotas. So it would be a good idea for any program to know where they are, and a really easy way to communicate that is with some slick visualizations. Today we’ll be using the <code>cfbfastR</code> package to get geographic data about recruits and the <code>urbnmapr</code> package to easily show them on maps.</p>
<p>I’m going to assume you have R and RStudio installed throughout this tutorial, so if you don’t go to <a href="https://saiemgilani.github.io/cfbfastR/articles/intro.html" class="external-link">cfbfastR founder Saiem Gilani’s tutorial</a> who goes through that process.</p>
<p>Let’s start off with loading all the packages we’ll need:</p>
<p>All of these packages are available on CRAN and thus can be installed by running <code>install.packages("your_package_here")</code>.</p>
<p>Now that we have all of our necessary packages loaded, we are free to start making some recruiting viz!</p>
<div class="section level2">
<h2 id="where-are-the-top-players-of-the-class-of-2021-from">Where are the Top Players of the Class of 2021 from?<a class="anchor" aria-label="anchor" href="#where-are-the-top-players-of-the-class-of-2021-from"></a>
</h2>
<p>We’ll start off by trying to answer that question. On the surface of it, the question seems pretty simple but implicitly has two other questions we much answer:</p>
<ol style="list-style-type: decimal">
<li>How are we defining Top Players?</li>
<li>How do we want to display this information?</li>
</ol>
<p>There’s about a bajillion different ways to answer these two questions, for example we could group the top 74 RBs by state and throw those counts on a table. For simplicity’s sake though let’s define the top players as 5 Stars, as defined by 247Sports, and since I think its easier to understand geography visually let’s make a map. Also this is not interactive and you cannot stop me from doing what I want.</p>
<p>The first thing we have to do is load in the data, and <code>cfbfastR</code> has a nice function which allows us to do just this, <code><a href="../reference/cfbd_recruiting_player.html">cfbd_recruiting_player()</a></code> which gives us info on every rated player in a class! Let’s see what sort of data we get from it.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="../reference/cfbd_recruiting_player.html">cfbd_recruiting_player</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fl">2021</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## cfbfastR_data [2,737 × 19] (S3: cfbfastR_data/tbl_df/tbl/data.table/data.frame)</span>
<span class="co">##  $ id                     : chr [1:2737] "71458" "71459" "71460" "71461" ...</span>
<span class="co">##  $ athlete_id             : chr [1:2737] "4431274" "4431437" NA "4431590" ...</span>
<span class="co">##  $ recruit_type           : chr [1:2737] "HighSchool" "HighSchool" "HighSchool" "HighSchool" ...</span>
<span class="co">##  $ year                   : int [1:2737] 2021 2021 2021 2021 2021 2021 2021 2021 2021 2021 ...</span>
<span class="co">##  $ ranking                : int [1:2737] 1 2 3 4 5 6 7 8 9 10 ...</span>
<span class="co">##  $ name                   : chr [1:2737] "Korey Foreman" "JC Latham" "J.T. Tuimoloau" "Jack Sawyer" ...</span>
<span class="co">##  $ school                 : chr [1:2737] "Centennial" "IMG Academy" "Eastside Catholic" "Pickerington North" ...</span>
<span class="co">##  $ committed_to           : chr [1:2737] "USC" "Alabama" NA "Ohio State" ...</span>
<span class="co">##  $ position               : chr [1:2737] "SDE" "OT" "SDE" "SDE" ...</span>
<span class="co">##  $ height                 : int [1:2737] 76 78 76 77 78 73 79 76 73 76 ...</span>
<span class="co">##  $ weight                 : int [1:2737] 265 305 277 248 283 210 315 245 190 265 ...</span>
<span class="co">##  $ stars                  : int [1:2737] 5 5 5 5 5 5 5 5 5 5 ...</span>
<span class="co">##  $ rating                 : num [1:2737] 0.999 0.999 0.999 0.998 0.998 ...</span>
<span class="co">##  $ city                   : chr [1:2737] "Corona" "Bradenton" "Sammamish" "Pickerington" ...</span>
<span class="co">##  $ state_province         : chr [1:2737] "CA" "FL" "WA" "OH" ...</span>
<span class="co">##  $ country                : chr [1:2737] "USA" "USA" "USA" "USA" ...</span>
<span class="co">##  $ hometown_info_latitude : chr [1:2737] "33.8752945" "27.4989278" "47.6088445" "39.896277299999994" ...</span>
<span class="co">##  $ hometown_info_longitude: chr [1:2737] "-117.5664449" "-82.5748194" "-122.0423067" "-82.77319049748806" ...</span>
<span class="co">##  $ hometown_info_fips_code: chr [1:2737] "06065" "12081" "53033" "39045" ...</span>
<span class="co">##  - attr(*, "cfbfastR_timestamp")= POSIXct[1:1], format: "2022-06-01 07:21:44"</span>
<span class="co">##  - attr(*, "cfbfastR_type")= chr "Player recruiting info from CollegeFootballData.com"</span></code></pre>
<p>There’s a lot here, but the basics are we get some IDs that we can merge on other <code>cfbfastR</code> datasets, basic information on each player, their high school, their rating and stars, their hometown, and geographic information about their hometown. A small issue we have is that for some reason the <code>hometown_info_longitude</code> and <code>hometown_info_latitude</code> variables which contain the longitude and latitude of each town are saved as characters (read: text) instead of numbers. But since we understand the data we’re looking at now, we can go ahead <code>filter</code> out for the set of players we want (5 stars) and <code>mutate</code> the data to make a new variable so that have longitudes and latitudes as numbers.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Save the class of 2021 to its own variable</span>
<span class="va">co_2021</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cfbd_recruiting_player.html">cfbd_recruiting_player</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fl">2021</span><span class="op">)</span>

<span class="co">#Now let's manipulate the data so that its what we want</span>
<span class="va">top_recs_co_2021</span> <span class="op">&lt;-</span> <span class="va">co_2021</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">stars</span> <span class="op">==</span> <span class="fl">5</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">#filter gives you the data which fulfills a condition</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span> <span class="co">#mutate creates new variables within a dataframe</span>
    latitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">as.double</a></span><span class="op">(</span><span class="va">hometown_info_latitude</span><span class="op">)</span>, 
    longitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">as.double</a></span><span class="op">(</span><span class="va">hometown_info_longitude</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">latitude</span>, <span class="va">longitude</span>, <span class="va">state_province</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">#This just selects the columns we care about</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="co">#this is to get rid of duplicate names</span></code></pre></div>
<p>A few quick programming notes:</p>
<ol style="list-style-type: decimal">
<li>I save the Class of 2021 dataset as its own object. This is so that if we make a mistake whilst manipulating the data we don’t have to load in the data again. For this specific problem its not a big deal, but when you deal with larger datasets that take longer to load its a good convention to do.</li>
<li>The <code>%&gt;%</code> characters are called a pipe and can be read as “and then.” As an example, we would read the above chunk as "We load in the Class of 2021 data and then we filter to only the 5 stars and then we create the new <code>longitude</code> and <code>latitude</code> variables.</li>
<li>The function <code>as.double</code> takes something and transforms it into a double (a number with a decimal points). For example, <code>"8.0"</code> and <code>8</code> both become <code>8.0</code> using <code><a href="https://rdrr.io/r/base/double.html" class="external-link">as.double()</a></code>
</li>
<li>At the end I <code>select</code> the columns which have the information we care about. This gets rid of extraneous data. This isn’t super important for this dataset in particular, but is a practice I find useful when working with larger datasets so I don’t take up too much memory.</li>
<li>The <code>distinct</code> function at the end gets rid of duplicate rows. We do this because recruiting data from <code>cfbd_recruiting_player</code> can at times be messy, especially when players have ratings which change later in the processs.</li>
</ol>
<p>So now let’s make a map of it. The most sensible thing to do seems to just put points on a map, one for each 5 star. This will tell us where every 5 star is, and if we’re lucky maybe we’ll get whiffs of larger trends. The easiest way to do this is to use the built in <code>states</code> dataframe that comes with <code>urbnmapr</code> and throw it in a plot. Because of how <code>urbnmapr</code> places Alaska and Hawai’i we can’t nicely place points in these states, so we’ll have to ignore these.</p>
<p>Before we look at the code there’s a couple <code>ggplot2</code> basics I would like to cover first</p>
<ol style="list-style-type: decimal">
<li>
<code>ggplot2</code> uses <code>+</code> instead of <code>%&gt;%</code> as a pipe for reasons that are beyond my feeble mind’s capabilities.</li>
<li>You place individual plot elements with the <code>geom_</code> functions. For example if you want to place a scatter plot that’s <code>geom_point</code>, for bars it’s <code>geom_bar</code>, for lines its <code>geom_line</code>, etc. Specifically for maps we use <code>geom_polygon</code>
</li>
<li>We map variables from a given data frame to geoms using the <code>aes</code> function.</li>
<li>The world isn’t flat, but plotting maps in R defaults to a flat projection (Mercator) which can cause some pretty massive distortion. We can fix this by changing to another projection which better maintains an area’s proportions (an Albers projection in this case)</li>
</ol>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cont_48</span> <span class="op">&lt;-</span> <span class="va">states</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">state_name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Alaska"</span>, <span class="st">"Hawaii"</span><span class="op">)</span><span class="op">)</span> <span class="co">#This means "Filter for states whose names aren't in the group of 'Hawaii' and 'Alaska'"</span>

<span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span> <span class="co">#ggplot uses + instead of %&gt;% as a pipe for some reason. </span>
  <span class="fu">geom_polygon</span><span class="op">(</span>data <span class="op">=</span> <span class="va">cont_48</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">'white'</span>, fill <span class="op">=</span> <span class="st">'grey'</span><span class="op">)</span><span class="op">+</span> <span class="co">#color controls the color of borders, fill controls the color of things inside the border</span>
  <span class="fu">geom_point</span><span class="op">(</span>data <span class="op">=</span> <span class="va">top_recs_co_2021</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span>, y <span class="op">=</span> <span class="va">latitude</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">'black'</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">coord_map</span><span class="op">(</span>projection <span class="op">=</span> <span class="st">'albers'</span>, lat0 <span class="op">=</span> <span class="fl">39</span>, lat1 <span class="op">=</span> <span class="fl">45</span><span class="op">)</span> <span class="co">#This is the one that changes the projection</span></code></pre></div>
<p><img src="map-tutorial_files/figure-html/gg_continental-1.png" width="700"></p>
<p>Great! We have successfully made a map where we can see where every single 5 star recruit in the Class of 2021 is from. We can see some overall trends, a lot in the southeast, a bunch collected in one spot in North Texas (that’s the Dallas-Fort Worth metro), and a surprising amount in Washington state (that’s Seattle). But what if we want to actually see who each of these dots represent? That’s not too hard! There is a <code>geom_text</code> geom which allows us to place text onto a plot given x and y coordinates. But with a plot like this we’ll probably get some overlap and it’ll be hard to read.</p>
<p>To avoid that, we’ll bring in the <code>ggrepel</code> library, which is on CRAN, which makes sure text doesn’t overlap on <code>ggplot2</code> plots. Uncomment the first line if you don’t have this package already installed.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#install.packages('ggrepel')</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/slowkow/ggrepel" class="external-link">ggrepel</a></span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html" class="external-link">geom_polygon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">cont_48</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">'white'</span>, fill <span class="op">=</span> <span class="st">'grey'</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">top_recs_co_2021</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span>, y <span class="op">=</span> <span class="va">latitude</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">'black'</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html" class="external-link">geom_text_repel</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">top_recs_co_2021</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span>, y <span class="op">=</span> <span class="va">latitude</span>, label <span class="op">=</span> <span class="va">name</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">'black'</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_map.html" class="external-link">coord_map</a></span><span class="op">(</span>projection <span class="op">=</span> <span class="st">'albers'</span>, lat0 <span class="op">=</span> <span class="fl">39</span>, lat1 <span class="op">=</span> <span class="fl">45</span><span class="op">)</span></code></pre></div>
<p><img src="map-tutorial_files/figure-html/ggplot_ggrepel-1.png" width="700"></p>
<p>Now this plot is a little busy, and eagle eyed readers will notice that several names are missing from this plot. This is because there are more overlaps than <code>ggrepel</code>’s algorithm can handle. This can be adjusted but it gets busier. Consider the task to improve this plot and make it more readable your homework!</p>
<p>What have we learned in this section? 1. How to load in recruiting class data using the <code><a href="../reference/cfbd_recruiting_player.html">cfbd_recruiting_player()</a></code> function in the <code>cfbfastR</code> package 2. How to use some basic <code>dplyr</code>data wrangling functions in <code>mutate</code>, <code>filter</code>, and <code>select</code> 3. How to use basic <code>ggplot2</code>commands 4. How to use the <code>urbnmapr</code> package to easily create maps</p>
</div>
<div class="section level2">
<h2 id="which-states-have-the-most-fbs-recruits-recently">Which States Have the Most FBS Recruits Recently?<a class="anchor" aria-label="anchor" href="#which-states-have-the-most-fbs-recruits-recently"></a>
</h2>
<p>This is cool that now we can place the top prospects on a map, but what if we are more interested in larger trends? We noticed that a lot of the top kids are generally from the south east, but does that hold true for all prospects? This is a question we can answer using the data we have!</p>
<p>So we have a straight forward question that doesn’t leave much room for interpretation, but we need to figure out how to go about answering it. We could use the data we’ve already loaded in and see where recruits are from for the 2021 class. But because of COVID, the 2021 class is odd, and an idea I want you dear reader to understand is that recruiting is a system. As families move around and populations shift different areas get better or worse in terms of recruiting talent. And this isn’t even considering shifting recruiting strategies and coaching changes to better or worse recruiters. Because of that, it’s not particularly useful to look at a single year of data.</p>
<p>With this in mind, let’s load multiple years of recruiting data into a single dataframe, group the prospects by the state they’re from, and then we can throw it up on a map! To accomplish this first task, we’re going to make a <code>for</code> loop. It’ll look like <code>for(i in 2017:2021)</code> which means we’ll first say <code>i = 2017</code> then do some stuff, then <code>i = 2018</code> and do the same stuff and repeat this process until we get to <code>i = 2021</code>. This is a bad habit, generally very slow in R, and should be avoided. We are doing it here because the <code><a href="../reference/cfbd_recruiting_player.html">cfbd_recruiting_player()</a></code> function is pretty fast so its not that slow to do a <code>for</code> loop and this is designed for learning and <code>for</code> loops are easy to read and understand. Generally, if you want to do the same thing over and over again you should use the <code>purrr</code> package which is much more optimized.</p>
<p>What we’re going to do is we’re going to look at the past 5 recruiting classes (2017, 2018, 2019, 2020, and 2021) and smush them all together into a single dataframe so its easier to work with. In the way we explained it earlier, we’re telling the little people in the computer to set the year to 2017, then they’ll get all the players in the 2017 class, then they’ll set the year to 2018, get all the players in that class, and then smush it to the earlier players. We’ll repeat this until we get to 2021.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">recruiting_classes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># this makes an empty dataframe</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2017</span><span class="op">:</span><span class="fl">2021</span><span class="op">)</span><span class="op">{</span>
  <span class="va">recruiting_classes</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">recruiting_classes</span>, <span class="fu"><a href="../reference/cfbd_recruiting_player.html">cfbd_recruiting_player</a></span><span class="op">(</span>year <span class="op">=</span> <span class="va">i</span><span class="op">)</span><span class="op">)</span> <span class="co">#This adds the rows from cfbd_recruiting_player() to the existing rows so we get all players</span>
<span class="op">}</span></code></pre></div>
<p>Sick, now we have all the players in the 2017-2021 classes. We want to eventually get the amount of recruits for every state in this time range, but remember from earlier that the data can get pretty messy and we don’t want to double count. So how are we going to clean it? What we’ll do is make a simple assumption that if, for example, there are 2 WRs named Daniel Jackson from the great state of Texas in 2017 then that is a duplicated entry. I feel fine about this and if you don’t, well you’re not writing this, it isn’t interactive, and I’m not your friend so you can’t tell me what to do.</p>
<p>So we’ll do this quick clean up and then we’ll group the players by state and get some counts.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">clean_rec_classes</span> <span class="op">&lt;-</span> <span class="va">recruiting_classes</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">name</span>, <span class="va">position</span>, <span class="va">state_province</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">#Get the data that we want</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">#Get rid of duplicated rows</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">state_province</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">#Group the data by each state</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span> <span class="co">#Summarise works like mutate, but instead of adding on a new column it creates a single row of variables for each group</span>
    count <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span> <span class="co">#n() is a function which returns the number of occurrences of each group in the larger dataset</span>
  <span class="op">)</span></code></pre></div>
<p>We introduced some new functions here, but I think <code>group_by</code> is pretty straightforward so I won’t explain that much further. <code>summarise</code> (you can also use <code>summarize</code> if you want) and <code>n()</code> however may not be as obvious. So if it’s not clear, let’s take a quick peek at the data:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">clean_rec_classes</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Rows: 61</span>
<span class="co">## Columns: 2</span>
<span class="co">## $ state_province <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "", "AB", "AK", "AL", "AR", "AS", "AZ", "BC", "CA", "CO…</span>
<span class="co">## $ count          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 11, 3, 5, 739, 174, 9, 385, 11, 2048, 156, 88, 101, 16,…</span></code></pre>
<p>So now we have the recruit count for every state from 2017-2021! You may be confused by the <code>""</code> and <code>"AB"</code> groups, but those refer to non-US provinces, which will end up being dropped.</p>
<p>We have the data, now we want to visualize this data. How should we go about it. We could just make a bar chart, and if we really wanted to emphasize the small and large differences between states this is a totally valid decision. But there’s some issues here. For one we totally lose the spatial aspects of recruiting in a bar chart, which I believe is important for our specific problem. Also, I think it’s boring. So what I want to do instead is represent this on a map using a color scale to show how many recruits came from the given state, if you care about jargon this is called a choropleth. The major issue with this is that humans are just bad at telling minute differences in color so we will only really get directional ideas of how many recruits from a given area. We won’t be able to tell if Tennessee has 3 more recruits than North Carolina, but we will be able to tell if Texas produces 250 more recruits than Nebraska. I think for the purpose of this plot its fine, and also it looks rad so we’ll do it.</p>
<p>Another issue we have is that the data we use to make the map doesn’t have the counts. So we need to merge these datasets together to make the plot. We’ll do this via an <code>inner_join</code> where we match the groups in the first dataset to groups in the second dataset and we end up with a dataset that has everything associated with each group.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">map_counts</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">states</span>, <span class="va">clean_rec_classes</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'state_abbv'</span><span class="op">=</span><span class="st">'state_province'</span><span class="op">)</span><span class="op">)</span>
<span class="co">#The by.x and by.y are necessary because the state abbreviations are under differently named columns in the two datasets</span></code></pre></div>
<p>Let’s take a peek at the data:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">map_counts</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Rows: 82,708</span>
<span class="co">## Columns: 10</span>
<span class="co">## $ long       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -88.47323, -88.46888, -88.46866, -88.45504, -88.45496, -88.…</span>
<span class="co">## $ lat        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 31.89386, 31.93026, 31.93317, 32.03972, 32.04058, 32.05305,…</span>
<span class="co">## $ order      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, …</span>
<span class="co">## $ hole       <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FAL…</span>
<span class="co">## $ piece      <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…</span>
<span class="co">## $ group      <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> 01.1, 01.1, 01.1, 01.1, 01.1, 01.1, 01.1, 01.1, 01.1, 01.1,…</span>
<span class="co">## $ state_fips <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "01", "01", "01", "01", "01", "01", "01", "01", "01", "01",…</span>
<span class="co">## $ state_abbv <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL",…</span>
<span class="co">## $ state_name <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Alabama", "Alabama", "Alabama", "Alabama", "Alabama", "Ala…</span>
<span class="co">## $ count      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 739, 739, 739, 739, 739, 739, 739, 739, 739, 739, 739, 739,…</span></code></pre>
<p>Awesome! We now have the counts and data we use to to make the map, so let’s make the plot now!</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">map_counts</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html" class="external-link">geom_polygon</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span>, fill <span class="op">=</span> <span class="va">count</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">'white'</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_map.html" class="external-link">coord_map</a></span><span class="op">(</span>projection <span class="op">=</span> <span class="st">'albers'</span>, lat0 <span class="op">=</span> <span class="fl">39</span>, lat1 <span class="op">=</span> <span class="fl">45</span><span class="op">)</span></code></pre></div>
<p><img src="map-tutorial_files/figure-html/map_counts_plot-1.png" width="700"></p>
<p>Tah-dah! We now can see that Texas, Florida, and California produce far and away the most recruits, Georgia is pretty good, and generally the southeast is ahead. That’s really all you need to make a couple sharp looking recruiting geography plots. With this you can go out into the world with your recruiting data and make any graph you desire. Unfortunately there is not county-level data available in the <code>cfbfastR</code> data, but if you wanted to make a plot focused on one state you could easily do that, you would just apply a <code>filter</code> so that you are only focused on map and recruiting data on that state.</p>
<p>What I’ll do now is go ahead and make a more fancy looking graph. I won’t explain what every individual piece uses beyond some comments, but I hope you can use it for some sort of template if you want to make anything yourself. This chart will show where all of the Pennsylvania, New Jersey, and New York prospects from 2017-2021 are from along with how many prospects overall came from each state using a unique color scale.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tri_state_recs</span> <span class="op">&lt;-</span> <span class="va">recruiting_classes</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">name</span>, <span class="va">position</span>, <span class="va">state_province</span>, <span class="va">hometown_info_latitude</span>, <span class="va">hometown_info_longitude</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">state_province</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'PA'</span>,<span class="st">'NY'</span>,<span class="st">'NJ'</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
    latitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">as.double</a></span><span class="op">(</span><span class="va">hometown_info_latitude</span><span class="op">)</span>,
    longitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">as.double</a></span><span class="op">(</span><span class="va">hometown_info_longitude</span><span class="op">)</span>
  <span class="op">)</span>

<span class="va">tri_state_map</span> <span class="op">&lt;-</span> <span class="va">map_counts</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">state_abbv</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'PA'</span>,<span class="st">'NY'</span>,<span class="st">'NJ'</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html" class="external-link">geom_polygon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">tri_state_map</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span>, fill <span class="op">=</span> <span class="va">count</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">'white'</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Spectral"</span><span class="op">)</span><span class="op">+</span> <span class="co">#This is built into ggplot2, it changes the the color of the fill scale</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">tri_state_recs</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span>, y <span class="op">=</span> <span class="va">latitude</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">'white'</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">'Where are Recruits in the Tri-State Area from?'</span>,
    subtitle <span class="op">=</span> <span class="st">'New York, Philadelphia, and Pittsburgh'</span>,
    fill <span class="op">=</span> <span class="st">'Number of Recruits'</span> <span class="co">#This will change the legend of the title</span>
  <span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span> <span class="co">#This makes the background white and the outline of the plot black among some other things. I think it looks clean</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>
    axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, <span class="co">#This takes away a part of the graph. Here we're taking away the axis titles bc they're implied here</span>
    axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, <span class="co">#This removes the ticks from the gridlines, I think they're kinda gross</span>
    axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, <span class="co">#Doesn't help the reader to know the specific longitude or latitude</span>
    panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
    panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, <span class="co">#This removes the gridlines</span>
    plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">16</span>, hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>, <span class="co">#This centers the title and makes the text bigger</span>
    plot.subtitle <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span>, hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>, 
    legend.position <span class="op">=</span> <span class="st">'bottom'</span> <span class="co">#This moves the legend to the bottom of the graph</span>
  <span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_map.html" class="external-link">coord_map</a></span><span class="op">(</span>projection <span class="op">=</span> <span class="st">'albers'</span>, lat0 <span class="op">=</span> <span class="fl">39</span>, lat1 <span class="op">=</span> <span class="fl">45</span><span class="op">)</span></code></pre></div>
<p><img src="map-tutorial_files/figure-html/tristate_recs-1.png" width="700"></p>
<p>Hope you found this tutorial useful! If you have any questions on how to manage recruiting data feel free to reach out to me on <a href="https://twitter.com/ConorMcQ5" class="external-link">Twitter</a>!</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://twitter.com/saiemgilani" class="external-link">Saiem Gilani</a>, <a href="https://twitter.com/akeaswaran" class="external-link">Akshay Easwaran</a>, <a href="https://twitter.com/JaredDLee" class="external-link">Jared Lee</a>, <a href="https://twitter.com/arbitanalytics" class="external-link">Eric Hess</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
